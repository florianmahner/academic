---
/**
 * Theme Styles Component
 *
 * Loads fonts and applies theme customization based on the selected preset.
 * Include this in your <head> to apply theme styling.
 *
 * Features:
 * - Loads preset-specific fonts from Google Fonts
 * - Applies config overrides on top of preset defaults
 * - Preconnect for faster font loading
 * - Uses display=swap to avoid FOIT
 */
import { config } from '../config';
import { getPreset, buildGoogleFontsUrl } from '../lib/presets';

// Get the selected preset
const presetId = config.theme.preset;
const preset = getPreset(presetId);

// Build Google Fonts URL for preset fonts
const fontsUrl = buildGoogleFontsUrl(preset);

// Get overrides from config
const overrides = config.theme.overrides;
const contentWidth = overrides.layout?.contentWidth || '750px';

// Check if accent colors are overridden
const hasAccentOverride = overrides.colors?.accent;
const hasAccentDarkOverride = overrides.colors?.accentDark;
---

<!-- DNS prefetch and preconnect for faster font loading -->
<link rel="dns-prefetch" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Load preset fonts -->
{fontsUrl && (
  <>
    <link href={fontsUrl} rel="stylesheet" media="print" onload="this.media='all'" />
    <noscript><link href={fontsUrl} rel="stylesheet" /></noscript>
  </>
)}

<style define:vars={{
  contentWidth: contentWidth,
  accentOverride: hasAccentOverride ? overrides.colors.accent : '',
  accentDarkOverride: hasAccentDarkOverride ? overrides.colors.accentDark : '',
}}>
  :root {
    /* Content width from config */
    --content-max-width: var(--contentWidth);
  }

  /* Apply accent color overrides if specified */
  :root {
    --color-accent-override: var(--accentOverride);
    --color-accent-dark-override: var(--accentDarkOverride);
  }
</style>

{/* Apply accent overrides via inline style if specified */}
{hasAccentOverride && (
  <style>
    :root {
      --preset-accent: {overrides.colors.accent} !important;
      --preset-accent-hover: color-mix(in srgb, {overrides.colors.accent} 85%, black) !important;
    }
  </style>
)}

{hasAccentDarkOverride && (
  <style>
    [data-theme="dark"] {
      --preset-accent: {overrides.colors.accentDark} !important;
      --preset-accent-hover: color-mix(in srgb, {overrides.colors.accentDark} 85%, white) !important;
    }
  </style>
)}
