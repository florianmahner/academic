---
/**
 * Structured Data Component
 * Provides JSON-LD structured data for SEO using config values
 */

import { config } from '../lib/config';

interface Props {
  type?: 'website' | 'article' | 'person';
  article?: {
    title: string;
    description: string;
    datePublished: Date;
    dateModified?: Date;
    image?: string;
  };
  breadcrumbs?: Array<{ name: string; url: string }>;
}

const { type = 'website', article, breadcrumbs } = Astro.props;
const siteUrl = config.site.url.replace(/\/$/, '');

// Build full name
const fullName = [config.name.first, config.name.middle, config.name.last].filter(Boolean).join(' ');

// Build Person schema
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": fullName,
  "jobTitle": config.title || undefined,
  "url": siteUrl,
  "sameAs": [
    config.social?.github ? `https://github.com/${config.social.github}` : null,
    config.social?.twitter ? `https://twitter.com/${config.social.twitter}` : null,
    config.social?.linkedin ? `https://linkedin.com/in/${config.social.linkedin}` : null,
    config.social?.scholar ? `https://scholar.google.com/citations?user=${config.social.scholar}` : null,
    config.social?.orcid ? `https://orcid.org/${config.social.orcid}` : null,
  ].filter(Boolean),
  "affiliation": config.institution ? {
    "@type": "Organization",
    "name": config.institution.name,
    "url": config.institution.url
  } : undefined,
  "knowsAbout": config.about?.research_interests?.split(',').map(i => i.trim()) || []
};

// Build WebSite schema
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": config.site.title || fullName,
  "url": siteUrl,
  "description": config.site.description,
  "author": {
    "@type": "Person",
    "name": fullName
  }
};

// Build Article schema
const articleSchema = article ? {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": article.title,
  "description": article.description,
  "datePublished": article.datePublished.toISOString(),
  "dateModified": (article.dateModified || article.datePublished).toISOString(),
  "author": {
    "@type": "Person",
    "name": fullName,
    "url": siteUrl
  },
  "publisher": {
    "@type": "Person",
    "name": fullName
  },
  "image": article.image ? new URL(article.image, siteUrl).toString() : undefined
} : null;

// Build Breadcrumb schema
const breadcrumbSchema = breadcrumbs ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.name,
    "item": item.url.startsWith('http') ? item.url : `${siteUrl}${item.url}`
  }))
} : null;
---

{type === 'person' && (
  <script type="application/ld+json" set:html={JSON.stringify(personSchema)} />
)}

{type === 'website' && (
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
)}

{articleSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
)}

{breadcrumbSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
)}
