---
/**
 * PaperCard Component
 * Display academic publication with preview, metadata, and links
 */
import Picture from '../ui/Picture.astro';
import ActionLink from '../primitives/ActionLink.astro';

interface Props {
  title: string;
  authors: string[];
  venue?: string;
  year?: number;
  preview?: string;
  pdf?: string;
  html?: string;
  code?: string;
  highlightAuthor?: string;
  compact?: boolean;
  class?: string;
}

const {
  title,
  authors,
  venue,
  year,
  preview,
  pdf,
  html,
  code,
  highlightAuthor = 'Mahner',
  compact = false,
  class: className,
} = Astro.props;

const primaryLink = pdf || html;
---

<article class:list={['paper-card', 'hover-item', { 'paper-card--compact': compact }, className]}>
  {preview && (
    <div class="paper-preview">
      <Picture src={preview} alt={title} width={140} height={90} loading="lazy" />
    </div>
  )}
  <div class="paper-content">
    <div class="paper-meta">
      {venue && <span class="paper-venue">{venue}</span>}
      {venue && year && <span class="paper-sep">Â·</span>}
      {year && <span class="paper-year">{year}</span>}
    </div>
    <h3 class="paper-title hover-title">
      {primaryLink ? (
        <a href={primaryLink} target="_blank" rel="noopener noreferrer">{title}</a>
      ) : (
        title
      )}
    </h3>
    <p class="paper-authors">
      {authors.map((author, i) => (
        <>
          <span class:list={{ 'highlight-author': author.includes(highlightAuthor) }}>
            {author}
          </span>
          {i < authors.length - 1 && ', '}
        </>
      ))}
    </p>
    <div class="paper-links">
      {pdf && <ActionLink href={pdf} label="PDF" icon="external" />}
      {html && <ActionLink href={html} label="Web" icon="globe" />}
      {code && <ActionLink href={code} label="Code" icon="code" />}
    </div>
  </div>
</article>

<style>
  .paper-card {
    display: grid;
    grid-template-columns: 140px 1fr;
    gap: var(--space-5);
    /* Padding, border-left, and hover handled by global .hover-item */
  }

  .paper-preview {
    flex-shrink: 0;
    width: 140px;
    height: 90px;
    overflow: hidden;
    border-radius: var(--radius-md);
    /* No border on publication GIFs */
  }

  .paper-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .paper-content {
    display: flex;
    flex-direction: column;
    min-width: 0;
  }

  .paper-meta {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-2);
  }

  .paper-venue {
    font-size: var(--font-size-xs);
    font-family: var(--font-body);
    color: var(--color-accent);
    font-weight: var(--font-weight-medium);
  }

  .paper-year {
    font-size: var(--font-size-xs);
    font-family: var(--font-body);
    color: var(--color-text-muted);
  }

  .paper-sep {
    font-size: var(--font-size-xs);
    font-family: var(--font-body);
    color: var(--color-text-muted);
    opacity: 0.5;
  }

  .paper-title {
    font-size: var(--font-size-base);
    font-family: var(--font-body);
    font-weight: var(--font-weight-semibold);
    font-style: normal;
    margin: 0 0 var(--space-2);
    line-height: var(--line-height-snug);
  }

  .paper-title a {
    color: var(--color-text);
    background: none;
    transition: color var(--transition-fast);
  }

  .paper-title a:hover {
    color: var(--color-accent);
  }

  .paper-authors {
    font-size: var(--font-size-sm);
    font-family: var(--font-body);
    color: var(--color-text-secondary);
    margin: 0 0 var(--space-3);
    line-height: var(--line-height-normal);
  }

  .highlight-author {
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
  }

  .paper-links {
    display: flex;
    gap: var(--space-3);
    margin-top: auto;
  }

  @media (max-width: 600px) {
    .paper-card {
      grid-template-columns: 1fr;
      gap: var(--space-3);
      padding: var(--space-3);
    }

    .paper-preview {
      width: 100%;
      max-width: 200px;
      height: auto;
      aspect-ratio: 16 / 10;
    }

    .paper-preview img {
      object-fit: contain;
    }

    .paper-meta {
      margin-bottom: var(--space-1);
    }

    .paper-title {
      font-size: var(--font-size-base);
      margin-bottom: var(--space-1);
    }

    .paper-authors {
      font-size: var(--font-size-sm);
      margin-bottom: var(--space-2);
    }

    .paper-links {
      gap: var(--space-2);
    }

    .paper-link {
      font-size: var(--font-size-xs);
      padding: var(--space-2);
    }
  }

  /* Compact mode - no previews, tighter spacing */
  .paper-card--compact {
    grid-template-columns: 1fr;
    padding: var(--space-3);
    gap: 0;
  }

  .paper-card--compact .paper-meta {
    margin-bottom: var(--space-1);
  }

  .paper-card--compact .paper-title {
    font-size: var(--font-size-sm);
    margin-bottom: var(--space-1);
  }

  .paper-card--compact .paper-authors {
    font-size: var(--font-size-xs);
    margin-bottom: var(--space-2);
  }

  .paper-card--compact .paper-links {
    gap: var(--space-2);
  }

  .paper-card--compact .paper-link {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
  }

  .paper-card--compact .paper-link svg {
    width: 12px;
    height: 12px;
  }
</style>
