---
/**
 * NewsCard Component
 * Universal card for displaying news items (blog posts, talks, publications)
 */

import { formatDate } from '../../lib/date-utils';
import Badge from '../ui/Badge.astro';
import ActionLink from '../primitives/ActionLink.astro';

interface Props {
  type: 'blog' | 'talk' | 'publication';
  title: string;
  description?: string;
  date: Date;
  tags?: string[];
  slug?: string;
  event?: string;
  location?: string;
  slides?: string;
  video?: string;
  authors?: string[];
  venue?: string;
  pdf?: string;
  code?: string;
  image?: string;
  class?: string;
}

const {
  type,
  title,
  description,
  date,
  tags = [],
  slug,
  event,
  location,
  slides,
  video,
  authors,
  venue,
  pdf,
  code,
  image,
  class: className,
} = Astro.props;

// Determine the link based on type
let href = '#';
if (type === 'blog' && slug) {
  href = `/blog/${slug}`;
} else if (type === 'talk' && slug) {
  href = `/talks/${slug}`;
}

// Type badge styling
const typeBadgeVariants = {
  blog: 'default',
  talk: 'accent',
  publication: 'success',
} as const;

// Type display names
const typeLabels = {
  blog: 'Blog Post',
  talk: 'Talk',
  publication: 'Publication',
};
---

<article class:list={['news-card', `news-card--${type}`, className]} data-animate="fade-up">
  <div class="news-card-inner">
    {image && type === 'blog' && (
      <div class="news-image">
        <img src={image} alt={title} loading="lazy" decoding="async" />
      </div>
    )}

    <div class="news-content">
      <div class="news-meta">
        <time datetime={date.toISOString()} class="news-date">{formatDate(date)}</time>
        <Badge size="sm" variant={typeBadgeVariants[type]}>{typeLabels[type]}</Badge>
      </div>

      <h3 class="news-title">
        {href !== '#' ? (
          <a href={href} class="news-link">{title}</a>
        ) : (
          <span>{title}</span>
        )}
      </h3>

      {description && (
        <p class="news-description">{description}</p>
      )}

      {type === 'talk' && (event || location) && (
        <div class="news-event">
          {event && <span class="event-name">{event}</span>}
          {location && <span class="event-location"> Â· {location}</span>}
        </div>
      )}

      {type === 'publication' && (
        <div class="news-publication-meta">
          {authors && authors.length > 0 && (
            <p class="publication-authors">
              {authors.slice(0, 3).join(', ')}
              {authors.length > 3 && ', et al.'}
            </p>
          )}
          {venue && <p class="publication-venue">{venue}</p>}
        </div>
      )}

      {tags && tags.length > 0 && (
        <div class="news-tags">
          {tags.slice(0, 3).map(tag => (
            <Badge size="sm" variant="outline">{tag}</Badge>
          ))}
        </div>
      )}

      {(slides || video || pdf || code) && (
        <div class="news-links">
          {slides && <ActionLink href={slides} label="Slides" icon="slides" />}
          {video && <ActionLink href={video} label="Video" icon="video" />}
          {pdf && <ActionLink href={pdf} label="PDF" icon="external" />}
          {code && <ActionLink href={code} label="Code" icon="code" />}
        </div>
      )}
    </div>
  </div>
</article>

<style>
  .news-card {
    border-radius: var(--radius-md);
    transition: background-color var(--transition-fast);
  }

  .news-card:hover {
    background-color: var(--color-bg-alt);
  }

  .news-card-inner {
    display: flex;
    flex-direction: column;
    padding: var(--space-4);
  }

  .news-image {
    margin-bottom: var(--space-3);
    border-radius: var(--radius-sm);
    overflow: hidden;
    aspect-ratio: 16 / 9;
  }

  .news-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .news-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .news-meta {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex-wrap: wrap;
  }

  .news-date {
    font-size: var(--font-size-xs);
    font-family: var(--font-body);
    color: var(--color-text-muted);
  }

  .news-title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-medium);
    margin: 0;
    line-height: var(--line-height-snug);
  }

  .news-link {
    color: inherit;
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .news-link:hover {
    color: var(--color-accent);
  }

  .news-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin: 0;
    line-height: var(--line-height-normal);
  }

  .news-event {
    font-size: var(--font-size-sm);
    margin-top: var(--space-1);
  }

  .event-name {
    color: var(--color-accent);
    font-weight: var(--font-weight-medium);
  }

  .event-location {
    color: var(--color-text-muted);
  }

  .news-publication-meta {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    margin-top: var(--space-1);
  }

  .publication-authors {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .publication-venue {
    font-size: var(--font-size-sm);
    color: var(--color-accent);
    font-weight: var(--font-weight-medium);
    margin: 0;
  }

  .news-tags {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
    margin-top: var(--space-1);
  }

  .news-links {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
    margin-top: var(--space-2);
  }

  @media (max-width: 640px) {
    .news-title {
      font-size: var(--font-size-base);
    }
  }
</style>
