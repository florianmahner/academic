---
/**
 * Teaching Index Page
 * Reads layout configuration from collection-pages/teaching.md frontmatter
 */
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { config } from '../../config';
import LayoutDispatcher from '../../components/layouts/LayoutDispatcher.astro';

// Get page configuration from frontmatter
const pageConfig = await getEntry('collection-pages', 'teaching');
if (!pageConfig) {
  throw new Error('Missing collection-pages/teaching.md - please create this file with layout configuration');
}

const { title, description, pageLayout, layoutConfig, sortBy, sortOrder } = pageConfig.data;

// Get all teaching entries
const teaching = await getCollection('teaching');

// Sort entries based on frontmatter config
const sortedEntries = teaching.sort((a, b) => {
  const fieldA = (a.data as any)[sortBy || 'year'] ?? (a.data as any).semester;
  const fieldB = (b.data as any)[sortBy || 'year'] ?? (b.data as any).semester;

  // Handle year sorting
  const yearA = typeof fieldA === 'number' ? fieldA : parseInt(String(fieldA).match(/\d{4}/)?.[0] || '0');
  const yearB = typeof fieldB === 'number' ? fieldB : parseInt(String(fieldB).match(/\d{4}/)?.[0] || '0');

  return sortOrder === 'asc' ? yearA - yearB : yearB - yearA;
});

const pageTitle = `${title} | ${config.site.title}`;
---

<BaseLayout title={pageTitle} description={description}>
  <article class="collection-page">
    <div class="container">
      <LayoutDispatcher
        collection="teaching"
        entries={sortedEntries}
        title={title}
        description={description}
        layoutOverride={pageLayout}
        configOverride={layoutConfig}
      />
    </div>
  </article>
</BaseLayout>

<style>
  .collection-page {
    /* Vertical padding handled by article in global.css */
  }
</style>
