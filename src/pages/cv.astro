---
import BaseLayout from '../layouts/BaseLayout.astro';
import Container from '../components/layout/Container.astro';
import Section from '../components/layout/Section.astro';
import TimelineItem from '../components/blocks/TimelineItem.astro';
import Badge from '../components/ui/Badge.astro';
import cvData from '../content/cv.json';
import { config } from '../config';
import { isSectionEnabled, DISABLED_SECTION_REDIRECT } from '../lib/sections';

// Redirect if section is disabled
if (!isSectionEnabled('cv')) {
  return Astro.redirect(DISABLED_SECTION_REDIRECT);
}

const title = `CV | ${config.site.title}`;
---

<BaseLayout title={title} description="Curriculum Vitae">
  <article class="cv-page">
    <Container>
      <header class="page-header" data-animate="fade-up">
        <h1>Curriculum Vitae</h1>
      </header>

      <Section spacing="lg">
        <h2 class="section-heading">Experience</h2>
        <div class="timeline" data-animate="stagger">
          {cvData.experience.map(exp => (
            <TimelineItem
              title={exp.title}
              subtitle={exp.organization}
              location={exp.location}
              startDate={exp.startDate}
              endDate={exp.endDate}
              description={exp.description}
              highlights={exp.highlights}
            />
          ))}
        </div>
      </Section>

      <Section spacing="lg">
        <h2 class="section-heading">Education</h2>
        <div class="timeline" data-animate="stagger">
          {cvData.education.map(edu => (
            <TimelineItem
              title={edu.degree}
              subtitle={edu.institution}
              location={edu.location}
              startDate={edu.year}
              description={edu.details}
            />
          ))}
        </div>
      </Section>

      <Section spacing="lg">
        <h2 class="section-heading">Skills</h2>
        <div class="skills-grid" data-animate="fade-up">
          {Object.entries(cvData.skills).map(([category, skills]) => (
            <div class="skill-category">
              <h3 class="skill-title">{category}</h3>
              <div class="skill-tags">
                {(skills as string[]).map(skill => (
                  <Badge variant="outline">{skill}</Badge>
                ))}
              </div>
            </div>
          ))}
        </div>
      </Section>

      {cvData.awards.length > 0 && (
        <Section spacing="lg">
          <h2 class="section-heading">Awards</h2>
          <div class="awards-list" data-animate="stagger">
            {cvData.awards.map(award => (
              <div class="award-item">
                <span class="award-title">{award.title}</span>
                <span class="award-meta">{award.issuer}, {award.year}</span>
              </div>
            ))}
          </div>
        </Section>
      )}
    </Container>
  </article>
</BaseLayout>

<style>
  .cv-page {
    padding: var(--space-8) 0;
  }

  .section-heading {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-2);
    border-bottom: 2px solid var(--color-border);
  }

  .timeline {
    padding-left: var(--space-2);
  }

  .skills-grid {
    display: grid;
    gap: var(--space-6);
  }

  .skill-category {
    margin-bottom: var(--space-4);
  }

  .skill-title {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    margin: 0 0 var(--space-2);
  }

  .skill-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .awards-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .award-item {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: var(--space-4);
    padding: var(--space-3);
    background-color: var(--color-bg-alt);
    border-radius: var(--radius-md);
  }

  .award-title {
    font-weight: var(--font-weight-medium);
  }

  .award-meta {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }
</style>
