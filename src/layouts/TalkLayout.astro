---
/**
 * Talk Layout
 * Layout for talks and presentations with slides, video, and event details
 */

import BaseLayout from './BaseLayout.astro';
import { config } from '../config';
import type { CollectionEntry } from 'astro:content';

interface Props {
  talk: CollectionEntry<'talks'>;
}

const { talk } = Astro.props;
const { Content } = await talk.render();

const {
  title,
  event,
  date,
  location,
  type = 'talk',
  abstract,
  description,
  slides,
  video,
} = talk.data;

const pageTitle = `${title} | ${config.site.title}`;
const pageDescription = description || abstract || `${title} at ${event}`;

// Format date safely
const formattedDate = date ? new Date(date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) : '';

const dateISOString = date ? new Date(date).toISOString() : '';

const typeLabels: Record<string, string> = {
  keynote: 'Keynote',
  invited: 'Invited Talk',
  talk: 'Talk',
  contributed: 'Talk',
  poster: 'Poster',
  workshop: 'Workshop',
  panel: 'Panel',
  tutorial: 'Tutorial',
  conference: 'Conference',
  seminar: 'Seminar'
};
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <article class="talk-article">
    <div class="container">
      <!-- Talk Header -->
      <header class="talk-header" data-animate="fadeIn">
        <div class="talk-meta">
          <span class:list={['type-badge', `type-${type}`]}>
            {typeLabels[type]}
          </span>
          <span class="meta-separator">Â·</span>
          <time datetime={dateISOString} class="talk-date">
            {formattedDate}
          </time>
        </div>

        <h1 class="talk-title">{title}</h1>

        <div class="talk-event-info">
          <div class="event-name">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>{event}</span>
          </div>
          {location && (
            <div class="event-location">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span>{location}</span>
            </div>
          )}
        </div>

        <!-- Links -->
        <div class="talk-links">
          {slides && (
            <a href={slides} class="talk-link" target="_blank" rel="noopener noreferrer">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
              </svg>
              Download Slides
            </a>
          )}
          {video && (
            <a href={video} class="talk-link" target="_blank" rel="noopener noreferrer">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
              </svg>
              Watch Video
            </a>
          )}
        </div>
      </header>

      <!-- Abstract -->
      {abstract && (
        <section class="talk-abstract" data-animate="slideUp">
          <h2>Abstract</h2>
          <p>{abstract}</p>
        </section>
      )}

      <!-- Additional Content -->
      <div class="talk-content" data-animate="slideUp">
        <Content />
      </div>
    </div>
  </article>

  <style>
    /* ============================================
       Talk Article Container
       ============================================ */
    .talk-article {
      padding: var(--content-top-padding) 0;
    }

    /* ============================================
       Talk Header
       ============================================ */
    .talk-header {
      margin-bottom: var(--space-10);
      max-width: 800px;
    }

    .talk-meta {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
      font-size: var(--font-size-sm);
      font-family: var(--font-body);
    }

    .type-badge {
      display: inline-block;
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-xs);
      font-family: var(--font-ui);
      font-weight: var(--font-weight-medium);
      text-transform: uppercase;
      letter-spacing: var(--letter-spacing-wide);
      border-radius: var(--radius-full);
    }

    .type-keynote {
      background: rgba(168, 85, 247, 0.1);
      color: rgb(168, 85, 247);
    }

    [data-theme="dark"] .type-keynote {
      background: rgba(168, 85, 247, 0.2);
      color: rgb(196, 181, 253);
    }

    .type-invited {
      background: rgba(59, 130, 246, 0.1);
      color: rgb(59, 130, 246);
    }

    [data-theme="dark"] .type-invited {
      background: rgba(59, 130, 246, 0.2);
      color: rgb(147, 197, 253);
    }

    .type-contributed,
    .type-workshop {
      background: rgba(34, 197, 94, 0.1);
      color: rgb(34, 197, 94);
    }

    [data-theme="dark"] .type-contributed,
    [data-theme="dark"] .type-workshop {
      background: rgba(34, 197, 94, 0.2);
      color: rgb(134, 239, 172);
    }

    .type-poster {
      background: rgba(234, 179, 8, 0.1);
      color: rgb(234, 179, 8);
    }

    [data-theme="dark"] .type-poster {
      background: rgba(234, 179, 8, 0.2);
      color: rgb(253, 224, 71);
    }

    .meta-separator {
      color: var(--color-text-muted);
    }

    .talk-date {
      font-weight: var(--font-weight-medium);
      color: var(--color-text-secondary);
    }

    .talk-title {
      font-size: var(--font-size-3xl);
      font-family: var(--font-heading);
      font-weight: var(--heading-weight);
      font-style: var(--heading-style);
      line-height: var(--line-height-tight);
      color: var(--color-text);
      margin: 0 0 var(--space-6);
    }

    /* ============================================
       Event Info
       ============================================ */
    .talk-event-info {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
      margin-bottom: var(--space-6);
    }

    .event-name,
    .event-location {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--font-size-base);
      font-family: var(--font-body);
      color: var(--color-text-secondary);
    }

    .event-name svg,
    .event-location svg {
      flex-shrink: 0;
      color: var(--color-accent);
    }

    .event-name span {
      font-weight: var(--font-weight-medium);
      color: var(--color-text);
    }

    /* ============================================
       Talk Links
       ============================================ */
    .talk-links {
      display: flex;
      gap: var(--space-3);
      flex-wrap: wrap;
    }

    .talk-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      font-size: var(--font-size-base);
      font-family: var(--font-body);
      font-weight: var(--font-weight-medium);
      color: var(--color-text-secondary);
      background: var(--color-bg-alt);
      border-radius: var(--radius-md);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    .talk-link:hover {
      color: var(--color-accent);
      background: var(--color-bg);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .talk-link svg {
      flex-shrink: 0;
    }

    /* ============================================
       Abstract Section
       ============================================ */
    .talk-abstract {
      margin-bottom: var(--space-10);
      max-width: 800px;
    }

    .talk-abstract h2 {
      font-size: var(--font-size-lg);
      font-family: var(--font-body);
      font-weight: var(--font-weight-medium);
      color: var(--color-text);
      margin-bottom: var(--space-4);
    }

    .talk-abstract p {
      font-size: var(--font-size-base);
      font-family: var(--font-body);
      line-height: var(--line-height-relaxed);
      color: var(--color-text-secondary);
      margin: 0;
    }

    /* ============================================
       Embed Sections (Slides/Video)
       ============================================ */
    .talk-embed {
      margin-bottom: var(--space-10);
    }

    .talk-embed h2 {
      font-size: var(--font-size-lg);
      font-family: var(--font-body);
      font-weight: var(--font-weight-medium);
      color: var(--color-text);
      margin-bottom: var(--space-4);
    }

    .embed-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: var(--color-bg-alt);
      border: 1px solid var(--color-border);
    }

    .embed-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .video-container {
      padding-bottom: 56.25%; /* 16:9 */
    }

    /* ============================================
       Additional Content
       ============================================ */
    .talk-content {
      max-width: 800px;
      font-family: var(--font-body);
      font-size: var(--font-size-base);
      line-height: var(--line-height-relaxed);
      color: var(--color-text);
    }

    .talk-content :global(h2) {
      font-size: var(--font-size-xl);
      font-family: var(--font-heading);
      font-weight: var(--font-weight-medium);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
    }

    .talk-content :global(p) {
      margin-bottom: var(--space-6);
    }

    /* ============================================
       Responsive
       ============================================ */
    @media (max-width: 768px) {
      .talk-title {
        font-size: var(--font-size-2xl);
      }

      .talk-event-info {
        font-size: var(--font-size-sm);
      }

      .talk-links {
        flex-direction: column;
      }

      .talk-link {
        justify-content: center;
        width: 100%;
      }
    }
  </style>
</BaseLayout>
