---
/**
 * Base Layout
 * The main layout wrapper for all pages
 *
 * Navigation modes:
 * - floating: Safari-style floating pill nav
 * - sidebar: Left sidebar next to content
 * - inline: Simple header nav
 */

import ThemeStyles from '../components/ThemeStyles.astro';
import AnimationInit from '../components/AnimationInit.astro';
import StructuredData from '../components/StructuredData.astro';
import SettingsPanel from '../components/SettingsPanel.astro';
import { config } from '../lib/config';
import { getNavigationWithActive, applyBasePath } from '../lib/navigation';
import '../styles/global.css';
import '../styles/view-tokens.css';

interface Props {
  title: string;
  description?: string;
  image?: string;
}

const {
  title,
  description = config.site.description,
  image = "/img/og-image.jpg"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const navMode = config.navigationMode;

// Get base path from Astro config (e.g., '/academic' for subdirectory deployments)
const base = import.meta.env.BASE_URL;

// Strip base path from current pathname for active state detection
// e.g., /academic/ becomes /, /academic/publications becomes /publications
const pathWithoutBase = base === '/'
  ? Astro.url.pathname
  : Astro.url.pathname.replace(new RegExp(`^${base}`), '') || '/';

// Get auto-generated navigation (with stripped path for active detection)
const navigation = await getNavigationWithActive(pathWithoutBase);

// Apply base path for rendering
const navItems = applyBasePath(navigation, base);

const fullName = [config.name.first, config.name.middle, config.name.last].filter(Boolean).join(' ');

// Social links with icons
const socialLinks = [
  config.social.github && { label: 'GitHub', href: `https://github.com/${config.social.github}`, icon: 'github' },
  config.social.scholar && { label: 'Scholar', href: `https://scholar.google.com/citations?user=${config.social.scholar}`, icon: 'scholar' },
  config.social.linkedin && { label: 'LinkedIn', href: `https://www.linkedin.com/in/${config.social.linkedin}`, icon: 'linkedin' },
  config.social.twitter && { label: 'Twitter', href: `https://twitter.com/${config.social.twitter}`, icon: 'twitter' },
  config.social.orcid && { label: 'ORCID', href: `https://orcid.org/${config.social.orcid}`, icon: 'orcid' },
  config.social.researchgate && { label: 'ResearchGate', href: `https://www.researchgate.net/profile/${config.social.researchgate}`, icon: 'researchgate' },
].filter(Boolean) as { label: string; href: string; icon: string }[];

// Add email as a social link with icon
const emailLink = config.email ? { label: 'Email', href: `mailto:${config.email}`, icon: 'email' } : null;

// SVG icons for social links
const socialIcons: Record<string, string> = {
  github: '<path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>',
  linkedin: '<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>',
  twitter: '<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>',
  scholar: '<path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>',
  orcid: '<path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zM7.369 4.378c.525 0 .947.431.947.947s-.422.947-.947.947a.95.95 0 0 1-.947-.947c0-.525.422-.947.947-.947zm-.722 3.038h1.444v10.041H6.647V7.416zm3.562 0h3.9c3.712 0 5.344 2.653 5.344 5.025 0 2.578-2.016 5.025-5.325 5.025h-3.919V7.416zm1.444 1.303v7.444h2.297c3.272 0 4.022-2.484 4.022-3.722 0-2.016-1.284-3.722-4.097-3.722h-2.222z"/>',
  researchgate: '<path d="M19.586 0H4.414C1.977 0 0 1.977 0 4.414v15.172C0 22.023 1.977 24 4.414 24h15.172C22.023 24 24 22.023 24 19.586V4.414C24 1.977 22.023 0 19.586 0zM8.67 20.715H5.908V9.312H8.67v11.403zm-1.38-12.952c-.882 0-1.598-.716-1.598-1.598s.716-1.598 1.598-1.598 1.598.716 1.598 1.598-.716 1.598-1.598 1.598zm12.584 12.952h-2.762v-5.549c0-1.324-.027-3.027-1.844-3.027-1.846 0-2.129 1.442-2.129 2.932v5.644H10.38V9.312h2.65v1.555h.037c.369-.699 1.271-1.436 2.615-1.436 2.795 0 3.312 1.84 3.312 4.234v7.05z"/>',
  email: '<path d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z"/><path d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z"/>',
};
---

<!DOCTYPE html>
<html lang="en" data-nav-mode={navMode}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="canonical" href={canonicalURL} />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />
    <link rel="icon" type="image/jpeg" href="/favicon.jpg" />
    <!-- Preconnect to external resources for faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <!-- KaTeX CSS for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous" media="print" onload="this.media='all'" />
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" /></noscript>
    <StructuredData type="WebSite" />
    <StructuredData type="Person" />
    <ThemeStyles />
    <script is:inline>
      (function() {
        const html = document.documentElement;

        // Apply light/dark theme
        const theme = localStorage.getItem('theme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        html.setAttribute('data-theme', theme);

        // Apply stored nav mode (or use config default)
        const navMode = localStorage.getItem('nav-mode');
        if (navMode) {
          html.setAttribute('data-nav-mode', navMode);
        }

        // Apply stored typography preset (fonts, colors, styles)
        // This will override config defaults if user has customized
        try {
          // Restore fonts
          const fontsStr = localStorage.getItem('typography-fonts');
          if (fontsStr) {
            const fonts = JSON.parse(fontsStr);
            html.style.setProperty('--font-body', '"' + fonts.body + '", Georgia, serif');
            html.style.setProperty('--font-heading', '"' + fonts.heading + '", Georgia, serif');
            html.style.setProperty('--font-ui', '"' + fonts.ui + '", system-ui, sans-serif');
            html.style.setProperty('--font-mono', '"' + fonts.mono + '", monospace');
          }

          // Restore colors
          const colorsStr = localStorage.getItem('typography-colors');
          if (colorsStr) {
            const colors = JSON.parse(colorsStr);
            html.style.setProperty('--color-accent-light', colors.accentLight);
            html.style.setProperty('--color-accent-dark', colors.accentDark);
          }

          // Restore typography styles
          const stylesStr = localStorage.getItem('typography-styles');
          if (stylesStr) {
            const styles = JSON.parse(stylesStr);
            html.style.setProperty('--heading-style', styles.headingStyle);
            html.style.setProperty('--heading-weight', styles.headingWeight);
            html.style.setProperty('--body-weight', styles.bodyWeight);
          }

          // Set typography attribute
          const presetId = localStorage.getItem('typography-preset');
          if (presetId) {
            html.setAttribute('data-typography', presetId);
          }
        } catch {}
      })();
    </script>
  </head>

  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="layout-wrapper">

      <!-- Floating Nav (Safari-style pill) -->
      <nav class="floating-nav" aria-label="Main navigation">
        <div class="floating-nav-pill">
          <ul class="floating-nav-links">
            {navItems.map(item => (
              <li>
                <a
                  href={item.href}
                  class:list={['floating-nav-link', { active: item.active }]}
                  target={item.external ? '_blank' : undefined}
                  rel={item.external ? 'noopener noreferrer' : undefined}
                >
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </div>
      </nav>

      <!-- Sidebar Nav (left of content) -->
      <aside class="sidebar-nav" aria-label="Main navigation">
        <nav class="sidebar-nav-inner">
          <ul class="sidebar-nav-links">
            {navItems.map(item => (
              <li>
                <a
                  href={item.href}
                  class:list={['sidebar-nav-link', { active: item.active }]}
                  target={item.external ? '_blank' : undefined}
                  rel={item.external ? 'noopener noreferrer' : undefined}
                >
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </aside>

      <!-- Inline Nav (header style) -->
      <header class="inline-nav" aria-label="Main navigation">
        <nav class="inline-nav-inner container">
          <ul class="inline-nav-links">
            {navItems.map(item => (
              <li>
                <a
                  href={item.href}
                  class:list={['inline-nav-link', { active: item.active }]}
                  target={item.external ? '_blank' : undefined}
                  rel={item.external ? 'noopener noreferrer' : undefined}
                >
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </header>

      <!-- Mobile Nav - Editorial Full-Screen Menu -->
      <button class="mobile-nav-toggle" aria-label="Open menu" aria-expanded="false">
        <span class="hamburger">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </span>
      </button>

      <div class="mobile-nav-menu" aria-hidden="true">
        <div class="mobile-nav-content">
          <nav class="mobile-nav-links-wrapper">
            <ul class="mobile-nav-links">
              {navItems.map((item, index) => (
                <li style={`--item-index: ${index}`}>
                  <a
                    href={item.href}
                    class:list={['mobile-nav-link', { active: item.active }]}
                    target={item.external ? '_blank' : undefined}
                    rel={item.external ? 'noopener noreferrer' : undefined}
                  >
                    <span class="mobile-nav-link-text">{item.label}</span>
                    {item.active && <span class="mobile-nav-active-indicator"></span>}
                  </a>
                </li>
              ))}
            </ul>
          </nav>
          <footer class="mobile-nav-footer">
            <span class="mobile-nav-name">{fullName}</span>
          </footer>
        </div>
      </div>

      <!-- Main Content -->
      <main class="main-content" id="main-content">
        <slot />
      </main>

      <!-- Footer -->
      <footer class="site-footer">
        <div class="container footer-content">
          <div class="footer-row">
            {config.footer.copyright && (
              <span class="footer-copy">&copy; {new Date().getFullYear()} {fullName}</span>
            )}

            {/* All icons in one row: email + social */}
            <div class="footer-icons">
              {emailLink && (
                <a
                  href={emailLink.href}
                  class="social-icon"
                  title={emailLink.label}
                  aria-label={emailLink.label}
                >
                  <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" set:html={socialIcons[emailLink.icon]} />
                </a>
              )}
              {socialLinks.map(link => (
                <a
                  href={link.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="social-icon"
                  title={link.label}
                  aria-label={link.label}
                >
                  <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" set:html={socialIcons[link.icon]} />
                </a>
              ))}
            </div>

            {/* Theme credit */}
            <span class="footer-credit">
              Built with <a href="https://github.com/florianmahner/academic-template" target="_blank" rel="noopener noreferrer">Prism</a>
            </span>
          </div>
        </div>
      </footer>
    </div>

    <style>
      /* ============================================
         Skip Link (accessibility feature)
         ============================================ */
      .skip-link {
        position: absolute;
        top: -100%;
        left: 16px;
        padding: 8px 16px;
        background: var(--color-accent);
        color: white;
        border-radius: var(--radius-md);
        z-index: 9999;
        text-decoration: none;
        font-weight: 500;
      }

      .skip-link:focus {
        top: 16px;
      }

      /* ============================================
         Layout Structure
         ============================================ */
      .layout-wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .main-content {
        flex: 1;
      }

      /* ============================================
         Navigation Visibility by Mode
         ============================================ */
      .floating-nav,
      .sidebar-nav,
      .inline-nav {
        display: none;
      }

      [data-nav-mode="floating"] .floating-nav { display: block; }
      [data-nav-mode="sidebar"] .sidebar-nav { display: block; }
      [data-nav-mode="inline"] .inline-nav { display: block; }

      /* Legacy mode support */
      [data-nav-mode="floating-icon"] .floating-nav { display: block; }
      [data-nav-mode="minimal"] .sidebar-nav { display: block; }

      /* ============================================
         FLOATING NAV - Minimal bottom pill
         Subtle, editorial design that integrates with content
         ============================================ */
      .floating-nav {
        position: fixed;
        bottom: calc(var(--space-8) + env(safe-area-inset-bottom, 0px));
        left: 50%;
        transform: translateX(-50%) translateY(0);
        z-index: var(--z-sticky);
        transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                    opacity 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .floating-nav.hidden {
        transform: translateX(-50%) translateY(calc(100% + var(--space-12)));
        opacity: 0;
        pointer-events: none;
      }

      .floating-nav-pill {
        display: flex;
        align-items: center;
        gap: 0;
        padding: 6px;
        background: var(--color-bg);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-full);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
      }

      [data-theme="dark"] .floating-nav-pill {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
      }

      .floating-nav-links {
        display: flex;
        align-items: center;
        gap: 0;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .floating-nav-links li {
        display: flex;
        align-items: center;
        margin: 0;
        padding: 0;
      }

      .floating-nav-link {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 32px;
        padding: 0 16px;
        font-family: var(--font-body);
        font-size: var(--font-size-base);
        font-weight: var(--font-weight-medium);
        line-height: 1;
        color: var(--color-text-muted);
        text-decoration: none;
        background: none;
        border-radius: var(--radius-full);
        transition: color 0.2s ease, background 0.2s ease;
      }

      .floating-nav-link:hover {
        color: var(--color-text);
      }

      .floating-nav-link.active {
        color: var(--color-text);
      }

      /* No content offset needed - nav is at bottom */
      [data-nav-mode="floating"] .main-content,
      [data-nav-mode="floating-icon"] .main-content {
        padding-top: 0;
        padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
      }

      /* ============================================
         SIDEBAR NAV - Alongside content (centered)
         ============================================ */
      [data-nav-mode="sidebar"] .layout-wrapper,
      [data-nav-mode="minimal"] .layout-wrapper {
        max-width: calc(var(--content-max-width) + 180px);
        margin: 0 auto;
        display: grid;
        grid-template-columns: 140px 1fr;
        grid-template-rows: 1fr auto;
        grid-template-areas:
          "sidebar main"
          "footer footer";
        gap: var(--space-8);
        padding: 0 var(--space-4);
      }

      .sidebar-nav {
        grid-area: sidebar;
        position: sticky;
        top: 0;
        height: fit-content;
        /* Match article padding exactly */
        padding-top: var(--content-top-padding);
      }

      .sidebar-nav-inner {
        display: flex;
        flex-direction: column;
      }

      .sidebar-nav-links {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      /* First link - remove top padding and left padding for exact alignment */
      .sidebar-nav-links li:first-child .sidebar-nav-link {
        padding-top: 0;
        padding-left: 0;
      }

      .sidebar-nav-link {
        display: block;
        padding: var(--space-2) 0;
        font-family: var(--font-body);
        font-size: var(--font-size-base);
        line-height: var(--line-height-normal);
        color: var(--color-text-muted);
        text-decoration: none;
        background: none;
        transition: all 0.15s ease;
      }

      .sidebar-nav-link:hover {
        color: var(--color-text);
      }

      .sidebar-nav-link.active {
        color: var(--color-text);
        font-weight: var(--font-weight-medium);
      }

      [data-nav-mode="sidebar"] .main-content,
      [data-nav-mode="minimal"] .main-content {
        grid-area: main;
        min-width: 0;
      }

      [data-nav-mode="sidebar"] .site-footer,
      [data-nav-mode="minimal"] .site-footer {
        grid-area: footer;
      }

      /* ============================================
         INLINE NAV - Header style
         ============================================ */
      .inline-nav {
        padding: var(--space-6) 0;
        border-bottom: 1px solid var(--color-border);
        margin-bottom: var(--space-6);
      }

      .inline-nav-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .inline-nav-links {
        display: flex;
        align-items: center;
        gap: var(--space-6);
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .inline-nav-link {
        font-family: var(--font-body);
        font-size: var(--font-size-base);
        color: var(--color-text-secondary);
        text-decoration: none;
        background: none;
        transition: color 0.15s ease;
      }

      .inline-nav-link:hover {
        color: var(--color-text);
      }

      .inline-nav-link.active {
        color: var(--color-accent);
      }

      /* ============================================
         MOBILE NAV - Editorial Full-Screen Menu
         ============================================ */
      .mobile-nav-toggle {
        display: none;
        position: fixed;
        top: var(--space-5);
        right: var(--space-5);
        z-index: calc(var(--z-modal) + 10);
        width: 44px;
        height: 44px;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }

      .hamburger {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 24px;
        height: 24px;
        gap: 6px;
      }

      .hamburger-line {
        display: block;
        width: 24px;
        height: 2px;
        background: var(--color-text);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
      }

      /* Hamburger to X animation */
      .mobile-nav-toggle[aria-expanded="true"] .hamburger-line:first-child {
        transform: translateY(4px) rotate(45deg);
      }

      .mobile-nav-toggle[aria-expanded="true"] .hamburger-line:last-child {
        transform: translateY(-4px) rotate(-45deg);
      }

      /* Full-screen menu */
      .mobile-nav-menu {
        display: none;
        position: fixed;
        inset: 0;
        z-index: var(--z-modal);
        background: var(--color-bg);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                    visibility 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .mobile-nav-menu.open {
        opacity: 1;
        visibility: visible;
      }

      .mobile-nav-content {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        min-height: 100%;
        padding: var(--space-20) var(--space-8) var(--space-8);
        overflow-y: auto;
      }

      .mobile-nav-links-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .mobile-nav-links {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: var(--space-1);
      }

      .mobile-nav-links li {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                    transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        transition-delay: calc(var(--item-index) * 0.06s + 0.1s);
      }

      .mobile-nav-menu.open .mobile-nav-links li {
        opacity: 1;
        transform: translateY(0);
      }

      .mobile-nav-link {
        display: inline-flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3) 0;
        font-family: var(--font-heading, var(--font-body));
        font-size: clamp(1.75rem, 5vw, 2.5rem);
        font-weight: var(--font-weight-light);
        letter-spacing: -0.02em;
        color: var(--color-text-muted);
        text-decoration: none;
        background: none;
        transition: color 0.2s ease;
      }

      .mobile-nav-link:hover,
      .mobile-nav-link:focus {
        color: var(--color-text);
      }

      .mobile-nav-link.active {
        color: var(--color-text);
      }

      .mobile-nav-link-text {
        position: relative;
      }

      .mobile-nav-active-indicator {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--color-accent);
        flex-shrink: 0;
      }

      .mobile-nav-footer {
        padding-top: var(--space-8);
        border-top: 1px solid var(--color-border);
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                    transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        transition-delay: 0.35s;
      }

      .mobile-nav-menu.open .mobile-nav-footer {
        opacity: 1;
        transform: translateY(0);
      }

      .mobile-nav-name {
        font-family: var(--font-body);
        font-size: var(--font-size-sm);
        color: var(--color-text-muted);
        letter-spacing: 0.02em;
      }

      /* Mobile breakpoint */
      @media (max-width: 768px) {
        .mobile-nav-toggle,
        .mobile-nav-menu {
          display: flex;
        }

        .floating-nav,
        .sidebar-nav,
        .inline-nav {
          display: none !important;
        }

        [data-nav-mode="sidebar"] .layout-wrapper,
        [data-nav-mode="minimal"] .layout-wrapper {
          display: flex;
          flex-direction: column;
        }

        .main-content {
          padding-top: var(--space-4) !important;
        }
      }

      /* Extra small screens */
      @media (max-width: 480px) {
        .mobile-nav-toggle {
          top: var(--space-4);
          right: var(--space-4);
        }

        .mobile-nav-content {
          padding: var(--space-12) var(--space-6);
        }

        .mobile-nav-link {
          font-size: clamp(1.5rem, 6vw, 2rem);
        }
      }

      /* ============================================
         FOOTER
         ============================================ */
      .site-footer {
        margin-top: var(--space-16);
        padding: var(--space-8) 0;
        border-top: 1px solid var(--color-border);
      }

      .footer-content {
        text-align: center;
      }

      .footer-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-4);
        flex-wrap: wrap;
        line-height: 1;
      }

      .footer-copy {
        font-size: var(--font-size-xs);
        color: var(--color-text-muted);
        line-height: 1;
      }

      .footer-icons {
        display: flex;
        gap: var(--space-2);
        align-items: center;
      }

      .social-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-text-muted);
        background: none;
        transition: color 0.15s ease;
        padding: 2px;
      }

      .social-icon:hover {
        color: var(--color-accent);
      }

      .social-icon svg {
        display: block;
        width: 16px;
        height: 16px;
      }

      .footer-credit {
        font-size: var(--font-size-xs);
        color: var(--color-text-muted);
        line-height: 1;
      }

      .footer-credit a {
        color: var(--color-text-muted);
        text-decoration: none;
        background: none;
        font-weight: 500;
        transition: color 0.15s ease;
      }

      .footer-credit a:hover {
        color: var(--color-accent);
      }

      @media (max-width: 500px) {
        .footer-secondary-nav {
          flex-wrap: wrap;
        }
      }
    </style>

    <script>
      // Mobile nav toggle - Editorial full-screen menu
      const toggle = document.querySelector('.mobile-nav-toggle');
      const menu = document.querySelector('.mobile-nav-menu');
      const navLinks = document.querySelectorAll('.mobile-nav-link');

      function openMobileNav() {
        menu?.classList.add('open');
        menu?.setAttribute('aria-hidden', 'false');
        toggle?.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }

      function closeMobileNav() {
        menu?.classList.remove('open');
        menu?.setAttribute('aria-hidden', 'true');
        toggle?.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }

      function toggleMobileNav() {
        const isOpen = toggle?.getAttribute('aria-expanded') === 'true';
        if (isOpen) {
          closeMobileNav();
        } else {
          openMobileNav();
        }
      }

      toggle?.addEventListener('click', toggleMobileNav);

      // Close when clicking a nav link
      navLinks.forEach(link => {
        link.addEventListener('click', closeMobileNav);
      });

      // Close on escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMobileNav();
      });

      // Floating nav auto-hide on scroll
      const floatingNav = document.querySelector('.floating-nav');
      let lastScrollY = window.scrollY;
      let ticking = false;
      const scrollThreshold = 50; // Minimum scroll before hiding

      function updateFloatingNav() {
        const currentScrollY = window.scrollY;
        const scrollDelta = currentScrollY - lastScrollY;

        if (floatingNav) {
          // Hide when scrolling down past threshold, show when scrolling up
          if (scrollDelta > 10 && currentScrollY > scrollThreshold) {
            floatingNav.classList.add('hidden');
          } else if (scrollDelta < -10 || currentScrollY < scrollThreshold) {
            floatingNav.classList.remove('hidden');
          }
        }

        lastScrollY = currentScrollY;
        ticking = false;
      }

      window.addEventListener('scroll', () => {
        if (!ticking) {
          requestAnimationFrame(updateFloatingNav);
          ticking = true;
        }
      }, { passive: true });

      // Show nav when hovering near bottom of screen
      document.addEventListener('mousemove', (e) => {
        if (floatingNav && window.innerHeight - e.clientY < 100) {
          floatingNav.classList.remove('hidden');
        }
      });
    </script>

    <AnimationInit />

    {/* Settings panel - allows users to customize theme */}
    <SettingsPanel />
  </body>
</html>
