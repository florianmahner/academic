---
/**
 * Blog Layout
 * Layout for blog posts with metadata, reading time, and prose styling
 */

import BaseLayout from './BaseLayout.astro';
import StructuredData from '../components/StructuredData.astro';
import { config } from '../config';

interface Props {
  title: string;
  description?: string;
  date: Date | string;
  author?: string;
  tags?: string[];
  readingTime?: string;
  image?: string;
}

const {
  title,
  description,
  date,
  author = config.name.first + ' ' + config.name.last,
  tags = [],
  readingTime,
  image
} = Astro.props;

// Format date
const formattedDate = new Date(date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

const pageTitle = `${title} | ${config.site.title}`;

// Get base URL for proper path prefixing
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

// Breadcrumbs for blog posts
const breadcrumbs = [
  { name: 'Home', url: base || '/' },
  { name: 'Blog', url: `${base}/blog` },
  { name: title, url: Astro.url.pathname }
];
---

<StructuredData
  type="article"
  article={{
    title: title,
    description: description || '',
    datePublished: new Date(date),
    dateModified: new Date(date),
    image: image
  }}
  breadcrumbs={breadcrumbs}
/>

<BaseLayout title={pageTitle} description={description} image={image}>
  <article class="blog-article">
    <div class="container">
      <!-- Blog Header -->
      <header class="blog-header" data-animate="fadeIn">
        <div class="blog-meta">
          <time datetime={new Date(date).toISOString()} class="blog-date">
            {formattedDate}
          </time>
          {readingTime && (
            <>
              <span class="meta-separator">·</span>
              <span class="reading-time">{readingTime}</span>
            </>
          )}
        </div>

        <h1 class="blog-title">{title}</h1>

        {description && (
          <p class="blog-description">{description}</p>
        )}

        <div class="blog-byline">
          <span class="blog-author">By {author}</span>
          {tags.length > 0 && (
            <div class="blog-tags">
              {tags.map(tag => (
                <span class="tag">{tag}</span>
              ))}
            </div>
          )}
        </div>
      </header>

      <!-- Blog Content -->
      <div class="blog-content prose" data-animate="slideUp">
        <slot />
      </div>

      <!-- Blog Footer (optional related posts section) -->
      <footer class="blog-footer" data-animate="fadeIn">
        <div class="blog-footer-nav">
          <a href={`${base}/blog`} class="back-link">← Back to all posts</a>
        </div>
      </footer>
    </div>
  </article>

  <style>
    /* ============================================
       Blog Article Container
       ============================================ */
    .blog-article {
      padding: var(--content-top-padding) 0;
    }

    /* ============================================
       Blog Header
       ============================================ */
    .blog-header {
      margin-bottom: var(--space-10);
      max-width: 720px;
    }

    .blog-meta {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      font-family: var(--font-body);
    }

    .blog-date {
      font-weight: var(--font-weight-medium);
      color: var(--color-accent);
    }

    .meta-separator {
      color: var(--color-text-muted);
    }

    .reading-time {
      color: var(--color-text-secondary);
    }

    .blog-title {
      font-size: var(--font-size-3xl);
      font-family: var(--font-heading);
      font-weight: var(--heading-weight);
      font-style: var(--heading-style);
      line-height: var(--line-height-tight);
      color: var(--color-text);
      margin: 0 0 var(--space-6);
    }

    .blog-description {
      font-size: var(--font-size-lg);
      font-family: var(--font-body);
      line-height: var(--line-height-relaxed);
      color: var(--color-text-secondary);
      margin: 0 0 var(--space-6);
    }

    .blog-byline {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
    }

    .blog-author {
      font-size: var(--font-size-base);
      font-family: var(--font-body);
      color: var(--color-text-secondary);
    }

    /* ============================================
       Tags
       ============================================ */
    .blog-tags {
      display: flex;
      gap: var(--space-2);
      flex-wrap: wrap;
    }

    .tag {
      display: inline-block;
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-xs);
      font-family: var(--font-ui);
      font-weight: var(--font-weight-medium);
      color: var(--color-text-secondary);
      background: var(--color-bg-alt);
      border-radius: var(--radius-full);
      transition: all var(--transition-fast);
    }

    .tag:hover {
      background: var(--color-accent);
      color: var(--color-bg);
    }

    /* ============================================
       Blog Content (Prose Styling)
       ============================================ */
    .blog-content {
      max-width: 720px;
      margin-bottom: var(--space-12);
    }

    .prose {
      font-family: var(--font-body);
      font-size: var(--font-size-base);
      line-height: var(--line-height-relaxed);
      color: var(--color-text);
    }

    /* Prose typography */
    .prose :global(h2) {
      font-size: var(--font-size-2xl);
      font-family: var(--font-heading);
      font-weight: var(--heading-weight);
      font-style: var(--heading-style);
      line-height: var(--line-height-tight);
      margin-top: var(--space-10);
      margin-bottom: var(--space-4);
      color: var(--color-text);
    }

    .prose :global(h2:first-child) {
      margin-top: 0;
    }

    .prose :global(h3) {
      font-size: var(--font-size-xl);
      font-family: var(--font-heading);
      font-weight: var(--font-weight-medium);
      line-height: var(--line-height-tight);
      margin-top: var(--space-8);
      margin-bottom: var(--space-3);
      color: var(--color-text);
    }

    .prose :global(p) {
      margin-bottom: var(--space-6);
    }

    .prose :global(a) {
      color: var(--color-accent);
      text-decoration: none;
      background: none;
      transition: opacity var(--transition-fast);
    }

    .prose :global(a:hover) {
      opacity: 0.7;
    }

    .prose :global(ul),
    .prose :global(ol) {
      margin: var(--space-6) 0;
      padding-left: var(--space-6);
    }

    .prose :global(li) {
      margin-bottom: var(--space-2);
    }

    .prose :global(blockquote) {
      margin: var(--space-8) 0;
      padding-left: var(--space-6);
      border-left: 3px solid var(--color-accent);
      font-style: italic;
      color: var(--color-text-secondary);
    }

    .prose :global(code) {
      font-family: var(--font-mono);
      font-size: 0.9em;
      padding: 0.2em 0.4em;
      background: var(--color-bg-alt);
      border-radius: var(--radius-sm);
    }

    .prose :global(pre) {
      margin: var(--space-6) 0;
      padding: var(--space-4);
      background: var(--color-bg-alt);
      border-radius: var(--radius-md);
      overflow-x: auto;
    }

    .prose :global(pre code) {
      padding: 0;
      background: none;
    }

    .prose :global(img) {
      margin: var(--space-8) 0;
      border-radius: var(--radius-md);
    }

    .prose :global(hr) {
      margin: var(--space-10) 0;
      border: none;
      border-top: 1px solid var(--color-border);
    }

    /* ============================================
       Blog Footer
       ============================================ */
    .blog-footer {
      padding-top: var(--space-8);
      border-top: 1px solid var(--color-border);
      max-width: 720px;
    }

    .blog-footer-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--font-size-base);
      font-family: var(--font-body);
      color: var(--color-text-secondary);
      text-decoration: none;
      background: none;
      transition: color var(--transition-fast);
    }

    .back-link:hover {
      color: var(--color-accent);
    }

    /* ============================================
       Responsive
       ============================================ */
    @media (max-width: 768px) {
      .blog-title {
        font-size: var(--font-size-2xl);
      }

      .blog-description {
        font-size: var(--font-size-base);
      }

      .prose :global(h2) {
        font-size: var(--font-size-xl);
      }

      .prose :global(h3) {
        font-size: var(--font-size-lg);
      }
    }
  </style>
</BaseLayout>
